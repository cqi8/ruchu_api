<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机舔狗段子 API</title>
    <script>
        // 读取 CSV 数据
        async function fetchData() {
            const response = await fetch('tiangou.csv');
            const text = await response.text();
            return text.split('\n').map(line => line.trim()).filter(line => line);
        }

        // 随机选择句子
        function getRandomSentence(sentences) {
            const randomIndex = Math.floor(Math.random() * sentences.length);
            return sentences[randomIndex];
        }

        // 处理 API 请求
        async function handleRequest() {
            const sentences = await fetchData();
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.has('json')) {
                // 以 JSON 格式输出
                const randomSentence = getRandomSentence(sentences);
                const jsonResponse = {
                    sentence: randomSentence
                };
                document.body.innerHTML = '<pre>' + JSON.stringify(jsonResponse, null, 2) + '</pre>';
            } else {
                // 随机显示一条句子
                const randomSentence = getRandomSentence(sentences);
                document.body.innerHTML = randomSentence + '</p>';
            }
        }

        window.onload = handleRequest;
    </script>
</head>
<body>
</body>
</html>
